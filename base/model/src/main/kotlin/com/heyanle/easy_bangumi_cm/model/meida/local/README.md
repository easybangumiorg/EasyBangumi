
# 关于本地库的扫描，刮削与挂载

> [!IMPORTANT]
> 在开发完视频类的项目扫描器后，才可以考虑开发音乐、电子书等资源的扫描器
> 开发时应当为后续的扩展留下空间，如在项目扫描器中应当考虑到子项目的扫描

> [!WARNING]
> 早期开发阶段，可能会翻译很多相关实现的代码，在之后会逐渐优化

## 假设

1. 根目录内每一个文件夹都是一个项目
2. 项目文件夹的名称一定包含这一项目的关键字，如‘葬送的芙莉莲’、‘你想活出怎样的人生’、‘鬼灭之刃 第X季 XXX篇’
3. 由项目文件夹内资源的类型确定项目所属的类型，这个类型是可叠加的，如’葬送的芙莉莲‘既可以包括系列电视节目，也可以包括电子书，甚至是音乐专辑
4. 项目内的子项目一定是与父项目有关的，如‘葬送的芙莉莲’的子项目可能是‘葬送的芙莉莲 OVA’、‘葬送的芙莉莲 第二季’
5. 同一个IP的不同资源可以分布在多个项目内（这个待定，会增加部分解析器工作量）

一个典型的项目结构如下：

XXXX
- XXXX 大电影.mkv
- XXXX 第一季
- - subtitles
- - - XXXX S1:E1.srt
- - - XXXX S1:E2.srt
- - XXXX S1:E1.mp4
- - XXXX S1:E2.mp4
- XXXX Season 2
- - XXXX S2:E1.mp4
- - XXXX S2:E1.srt
- - XXXX S2:E2.mp4
- - XXXX S2:E2.srt
- XXXX OST
- - XXXX OST 1.mp3
- - XXXX OST 2.wav
- XXXX Books
- - XXXX Book 1.pdf
- - XXXX Book 2.mobi
- - XXXX Book 3.epub

另一个常见的项目结构如下：

XXXX
- []XXXX - 1[][][].mp4
- []XXXX - 2[][][].mp4
- []XXXX - 3[][][].mp4

## 要求

1. 在根目录创建.manifest文件夹，记录整个库的快照，用于记录库的变更
2. 美术图资源，存于项目或是子项目的文件夹内
3. 元数据以MediaBrowser兼容的nfo文件存储（这个也待定，需要更上层的开发支持）
4. 本地扫描器仅提供对本地项目文件类型的抽象，返回树形的虚拟项目结构，再由上层根据项目的刮削结果进行同类项合并
5. 单独的电影文件为其额外创建MeidaNode（作废）

```text
Root > [
    Project > SubProject > Resource
    Project > Resource
]
```

## 本地库扫描步骤

1. 提供根目录，库配置
2. DFS遍历库存目录，获取文件系统树 FileSystemNode
3. 获取媒体节点树，电影与视频节点的区分标准待定，一般来说，电影外层都会包层文件夹，但是属于一个系列的电影与平级项目之间并不常见，不妨假定与子项目文件夹平级的视频文件为电影，而平级的其他非子项目媒体节点是该电影或共享的资源，应该以名称予以区分

我趣Jellyfin这栈怎么到处飞的，我倒要看看他们怎么做的 ，当然最后呈现的效果应该同网易爆米花.